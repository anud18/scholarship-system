# API Client Modularization

## ç›®æ¨™

å°‡ 4000+ è¡Œçš„ `lib/api.ts` æ‹†åˆ†æˆå¯ç¶­è­·çš„æ¨¡çµ„çµæ§‹ã€‚

## ç•¶å‰ç‹€æ…‹

**Phase 1 å®Œæˆ** âœ…
- ä½¿ç”¨ç›¸å°è·¯å¾‘ + Nginx åå‘ä»£ç†
- ç§»é™¤ `NEXT_PUBLIC_API_URL` ä¾è³´

**Phase 2 åŸºç¤æ¶æ§‹å®Œæˆ** âœ…
- `client.ts` - ApiClient åŸºç¤é¡
- `modules/auth.ts` - èªè­‰æ¨¡çµ„ç¤ºç¯„
- `index.ts` - çµ±ä¸€å°å‡ºä»‹é¢
- `__tests__/modular-api.test.ts` - æ¸¬è©¦è¦†è“‹ (18 æ¸¬è©¦å…¨é)

**Phase 3 æº–å‚™é–‹å§‹** ğŸš§
- å°å‹æ¨¡çµ„é·ç§» (users, scholarships, notifications)
- æˆ–é¸æ“‡ quotaApi æ•´åˆä½œç‚ºç¬¬äºŒå€‹ç¤ºç¯„

## ç›®éŒ„çµæ§‹

```
lib/api/
â”œâ”€â”€ client.ts              # âœ… ApiClient åŸºç¤é¡
â”œâ”€â”€ index.ts              # âœ… çµ±ä¸€å°å‡ºä»‹é¢
â”œâ”€â”€ __tests__/            # âœ… æ¸¬è©¦ç›®éŒ„
â”‚   â””â”€â”€ modular-api.test.ts  # æ¨¡çµ„åŒ– API æ¸¬è©¦ (18 tests pass)
â”œâ”€â”€ modules/               # API æ¨¡çµ„
â”‚   â”œâ”€â”€ auth.ts           # âœ… èªè­‰ API (å®Œæ•´å¯¦ç¾)
â”‚   â”œâ”€â”€ users.ts          # â³ å¾…å¯¦æ–½
â”‚   â”œâ”€â”€ scholarships.ts   # â³ å¾…å¯¦æ–½
â”‚   â”œâ”€â”€ applications.ts   # â³ å¾…å¯¦æ–½
â”‚   â”œâ”€â”€ notifications.ts  # â³ å¾…å¯¦æ–½
â”‚   â”œâ”€â”€ admin/            # Admin æ¨¡çµ„ç¾¤çµ„
â”‚   â”‚   â”œâ”€â”€ index.ts      # â³ Admin çµ±ä¸€å°å‡º
â”‚   â”‚   â”œâ”€â”€ scholarships.ts
â”‚   â”‚   â”œâ”€â”€ configurations.ts
â”‚   â”‚   â”œâ”€â”€ rules.ts
â”‚   â”‚   â””â”€â”€ users.ts
â”‚   â””â”€â”€ ... (å…¶ä»– 14 å€‹æ¨¡çµ„)
â””â”€â”€ README.md            # æœ¬æ–‡ä»¶
```

## ä½¿ç”¨æ–¹å¼

### ç•¶å‰ (lib/api.ts)
```typescript
import { api } from '@/lib/api';  // ä½¿ç”¨åŸå§‹ api.ts

const response = await api.auth.login(username, password);
```

### æ¨¡çµ„åŒ–ç‰ˆæœ¬ (å¯é¸ä½¿ç”¨)
```typescript
import { api } from '@/lib/api/index';  // æ˜ç¢ºä½¿ç”¨æ¨¡çµ„åŒ–ç‰ˆæœ¬

// API ä½¿ç”¨æ–¹å¼å®Œå…¨ç›¸åŒ - å‘å¾Œå…¼å®¹
const response = await api.auth.login(username, password);
```

**æ³¨æ„**: ç•¶å‰å…©å€‹ç‰ˆæœ¬ä¸¦å­˜
- `@/lib/api` â†’ åŸå§‹ api.ts (4017 è¡Œ)
- `@/lib/api/index` â†’ æ¨¡çµ„åŒ–ç‰ˆæœ¬ (å·²æ¸¬è©¦ï¼Œåƒ…åŒ…å« auth æ¨¡çµ„)
- å¾…æ‰€æœ‰æ¨¡çµ„é·ç§»å®Œæˆå¾Œï¼Œå°‡åŸå§‹ api.ts æ›¿æ›ç‚ºæ¨¡çµ„åŒ–ç‰ˆæœ¬çš„ re-export

## æ¨¡çµ„åŒ–é€²åº¦

| æ¨¡çµ„ | è¡Œæ•¸ | ç‹€æ…‹ | å„ªå…ˆç´š |
|------|------|------|--------|
| auth | ~60 | âœ… å®Œæˆ | P0 (ç¤ºç¯„) |
| users | ~80 | â³ å¾…åš | P1 |
| scholarships | ~45 | â³ å¾…åš | P1 |
| applications | ~180 | â³ å¾…åš | P1 |
| notifications | ~70 | â³ å¾…åš | P2 |
| admin | ~820 | â³ å¾…åš | P2 (éœ€äºŒæ¬¡æ‹†åˆ†) |
| å…¶ä»– 12 å€‹æ¨¡çµ„ | ~2500 | â³ å¾…åš | P3 |

## å¯¦æ–½æ­¥é©Ÿ

### Step 1: åŸºç¤çµæ§‹ âœ…
- [x] å‰µå»º `lib/api/` ç›®éŒ„
- [x] æå– `ApiClient` åˆ° `client.ts`
- [x] å‰µå»ºç¤ºç¯„æ¨¡çµ„ `modules/auth.ts`
- [x] å‰µå»º `index.ts` çµ±ä¸€å°å‡º
- [x] ç·¨å¯«æ¸¬è©¦ `__tests__/modular-api.test.ts` (18 tests pass)

### Step 2: é¡å‹æå– (å¯é¸)
- [ ] å‰µå»º `types.ts` æå–å…±ç”¨é¡å‹
- [ ] æˆ–é€æ­¥åœ¨å„æ¨¡çµ„ä¸­å®šç¾©æ‰€éœ€é¡å‹
- **ç•¶å‰ç­–ç•¥**: å¾åŸå§‹ `api.ts` re-export é¡å‹ï¼Œå¾…æ‰€æœ‰æ¨¡çµ„é·ç§»å¾Œå†çµ±ä¸€æ•´ç†

### Step 3: å°å‹æ¨¡çµ„é·ç§» (å¾…åš)
- [ ] users (80 è¡Œ)
- [ ] scholarships (45 è¡Œ)
- [ ] notifications (70 è¡Œ)

### Step 4: ä¸­å‹æ¨¡çµ„é·ç§» (å¾…åš)
- [ ] applications (180 è¡Œ)
- [ ] college (~110 è¡Œ)
- [ ] professor (~125 è¡Œ)

### Step 5: å¤§å‹æ¨¡çµ„æ‹†åˆ† (å¾…åš)
- [ ] admin (820 è¡Œ) â†’ æ‹†åˆ†æˆå¤šå€‹å­æ¨¡çµ„
  - admin/scholarships.ts
  - admin/configurations.ts
  - admin/rules.ts
  - admin/users.ts
  - admin/system.ts

### Step 6: çµ±ä¸€å°å‡º (å¾…åš)
- [ ] å‰µå»º `index.ts` çµ±ä¸€å°å‡ºæ‰€æœ‰æ¨¡çµ„
- [ ] æ›´æ–°æ‰€æœ‰ import è·¯å¾‘
- [ ] å‘å¾Œå…¼å®¹è™•ç†

### Step 7: æ¸…ç† (å¾…åš)
- [ ] ç§»é™¤æˆ–æ¨™è¨˜ç‚º deprecated åŸå§‹ `lib/api.ts`
- [ ] æ›´æ–°æ–‡æª”
- [ ] å®Œæ•´æ¸¬è©¦

## è¨­è¨ˆåŸå‰‡

1. **å‘å¾Œå…¼å®¹**: ä¿æŒç¾æœ‰ API ä½¿ç”¨æ–¹å¼ä¸è®Š
2. **æ¼¸é€²å¼é·ç§»**: æ¯æ¬¡é·ç§» 2-3 å€‹æ¨¡çµ„ä¸¦æ¸¬è©¦
3. **æ¸…æ™°è·è²¬**: æ¯å€‹æ¨¡çµ„è·è²¬å–®ä¸€ï¼Œæ˜“æ–¼ç†è§£
4. **é¡å‹å®‰å…¨**: å®Œæ•´çš„ TypeScript é¡å‹å®šç¾©
5. **å¯æ¸¬è©¦æ€§**: æ¯å€‹æ¨¡çµ„ç¨ç«‹å¯æ¸¬è©¦

## æ™‚é–“ä¼°ç®—

| éšæ®µ | æ™‚é–“ | èªªæ˜ |
|------|------|------|
| åŸºç¤çµæ§‹ + æ¸¬è©¦ | 2h | âœ… å·²å®Œæˆ (å« index.ts + 18 æ¸¬è©¦) |
| å°å‹æ¨¡çµ„ (8å€‹) | 3h | æ¯å€‹ 20-30 åˆ†é˜ |
| ä¸­å‹æ¨¡çµ„ (4å€‹) | 2h | æ¯å€‹ 30-45 åˆ†é˜ |
| å¤§å‹æ¨¡çµ„æ‹†åˆ† | 3h | admin éœ€è¦ä»”ç´°æ‹†åˆ† |
| æœ€çµ‚æ•´åˆ + å›æ­¸æ¸¬è©¦ | 1h | æ›¿æ› api.ts, å…¨é¢æ¸¬è©¦ |
| **å‰©é¤˜** | **9h** | å¯åˆ†å¤šæ¬¡å®Œæˆ |
| **ç¸½è¨ˆ** | **11h** | åŸºç¤å®Œæˆ 2h, å‰©é¤˜ 9h |

## ä¸‹ä¸€æ­¥

å¯é¸æ“‡ä»¥ä¸‹æ–¹æ¡ˆä¹‹ä¸€ï¼š

### æ–¹æ¡ˆ A: ç¹¼çºŒæ¨¡çµ„åŒ–
é€æ­¥å®Œæˆæ‰€æœ‰æ¨¡çµ„é·ç§» (éœ€ 10+ å°æ™‚)

### æ–¹æ¡ˆ B: æš«åœæ¨¡çµ„åŒ–
- ä¿ç•™ç•¶å‰æ¶æ§‹ä½œç‚ºåƒè€ƒ
- æ–°åŠŸèƒ½ä½¿ç”¨æ¨¡çµ„åŒ–æ–¹å¼
- èˆŠä»£ç¢¼ç¶­æŒç¾ç‹€
- ç­‰å¾…åˆé©æ™‚æ©Ÿå†å®Œæ•´é·ç§»

### æ–¹æ¡ˆ C: æ•´åˆ quotaApi
- å…ˆå°‡ `services/api/quotaApi.ts` æ•´åˆåˆ°ä¸» API
- ä½¿ç”¨æ–°çš„æ¨¡çµ„åŒ–æ¶æ§‹
- ä½œç‚ºæ¨¡çµ„åŒ–çš„ç¬¬äºŒå€‹ç¤ºç¯„

## æ³¨æ„äº‹é …

1. **ä¸è¦ä¸€æ¬¡æ€§é·ç§»æ‰€æœ‰æ¨¡çµ„** - é¢¨éšªå¤ªé«˜
2. **æ¯æ¬¡é·ç§»å¾Œéƒ½è¦æ¸¬è©¦** - ç¢ºä¿åŠŸèƒ½æ­£å¸¸
3. **ä¿æŒ commit å°è€Œé »ç¹** - ä¾¿æ–¼å›æ»¾
4. **æ›´æ–°ç›¸é—œæ¸¬è©¦** - ç¢ºä¿æ¸¬è©¦è¦†è“‹ç‡
5. **æ–‡æª”åŒæ­¥æ›´æ–°** - ä¿æŒæ–‡æª”æœ€æ–°

## ç•¶å‰æˆæœç¸½çµ

âœ… **åŸºç¤æ¶æ§‹å®Œæˆ** (2 å°æ™‚å®Œæˆ)
1. **ApiClient åŸºç¤é¡** (`client.ts`, 236 è¡Œ)
   - ç›¸å°è·¯å¾‘æ”¯æ´ (ç€è¦½å™¨) + å…§éƒ¨ URL (SSR)
   - å®Œæ•´çš„ token ç®¡ç† (set/get/clear/has)
   - çµ±ä¸€çš„è«‹æ±‚è™•ç†èˆ‡éŒ¯èª¤è™•ç†
   - Query åƒæ•¸è‡ªå‹•è™•ç†
   - ApiResponse æ ¼å¼è‡ªå‹•è½‰æ›

2. **Auth æ¨¡çµ„** (`modules/auth.ts`, 133 è¡Œ)
   - login, logout, register
   - getCurrentUser, refreshToken
   - getMockUsers, mockSSOLogin
   - è‡ªå‹• token ç®¡ç†æ•´åˆ

3. **çµ±ä¸€å°å‡º** (`index.ts`, 90 è¡Œ)
   - ExtendedApiClient é¡åˆ¥
   - å‘å¾Œå…¼å®¹çš„ api/apiClient å°å‡º
   - é¡å‹ re-export è‡ªåŸå§‹ api.ts
   - æº–å‚™å¥½æ¥ç´æ›´å¤šæ¨¡çµ„

4. **å®Œæ•´æ¸¬è©¦è¦†è“‹** (`__tests__/modular-api.test.ts`, 245 è¡Œ)
   - 18 å€‹æ¸¬è©¦å…¨éƒ¨é€šé âœ…
   - å°å‡ºé©—è­‰ã€Auth æ¨¡çµ„åŠŸèƒ½ã€Token ç®¡ç†ã€è«‹æ±‚æ–¹æ³•
   - å¯ä½œç‚ºå…¶ä»–æ¨¡çµ„æ¸¬è©¦çš„æ¨¡æ¿

ğŸ¯ **æ¶æ§‹å„ªå‹¢**
- âœ… æ¨¡çµ„åŒ–: æ¯å€‹æ¨¡çµ„ç¨ç«‹ï¼Œæ˜“æ–¼ç¶­è­·
- âœ… æ¸¬è©¦: å®Œæ•´æ¸¬è©¦è¦†è“‹ï¼Œç¢ºä¿å“è³ª
- âœ… å‘å¾Œå…¼å®¹: API ä½¿ç”¨æ–¹å¼ä¸è®Š
- âœ… é¡å‹å®‰å…¨: å®Œæ•´ TypeScript æ”¯æ´
- âœ… æ¼¸é€²å¼é·ç§»: å¯é€æ­¥é·ç§»ï¼Œç„¡éœ€ä¸€æ¬¡æ€§å®Œæˆ

## åƒè€ƒ

- åŸå§‹æ–‡ä»¶: `lib/api.ts` (4017 è¡Œ)
- ç›¸å°è·¯å¾‘é‡æ§‹: Commit 6e1e13d
- æ¸¬è©¦ä¿®æ­£: Commit eae0030
- æ¨¡çµ„åŒ–åŸºç¤: ç•¶å‰ session (index.ts + auth æ¨¡çµ„ + æ¸¬è©¦)
